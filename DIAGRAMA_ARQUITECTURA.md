# ğŸ—ï¸ Diagrama de Arquitectura

## Estructura Visual del Proyecto

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           index.html                              â”‚
â”‚                      (Punto de Entrada HTML)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          main.js                                  â”‚
â”‚                    (Orquestador Principal)                        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    class App                             â”‚   â”‚
â”‚  â”‚  - engine                                                â”‚   â”‚
â”‚  â”‚  - sceneManager                                          â”‚   â”‚
â”‚  â”‚  - playerController                                      â”‚   â”‚
â”‚  â”‚  - inputManager                                          â”‚   â”‚
â”‚  â”‚  - uiManager                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚       â”‚       â”‚       â”‚       â”‚
        â–¼       â–¼       â–¼       â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Engine   â”‚ â”‚  Scene   â”‚ â”‚ Player  â”‚ â”‚  Input   â”‚ â”‚    UI     â”‚
â”‚           â”‚ â”‚ Manager  â”‚ â”‚Controllerâ”‚ â”‚ Manager  â”‚ â”‚  Manager  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚            â”‚            â”‚           â”‚             â”‚
      â”‚            â”‚            â”‚           â”‚             â”‚
      â”‚            â”‚            â”‚           â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚                     src/core/State.js                            â”‚
â”‚                (Estado Global Centralizado)                      â”‚
â”‚                                                                  â”‚
â”‚  {                                                               â”‚
â”‚    player: {...},        // PosiciÃ³n, velocidad, fÃ­sica         â”‚
â”‚    camera: {...},        // Yaw, pitch, sensibilidad            â”‚
â”‚    input: {...},         // Teclas, mouse                       â”‚
â”‚    ui: {...},            // Pointer lock, overlays              â”‚
â”‚    scene: {...}          // Portales, grounds, mixers           â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flujo de EjecuciÃ³n

```
1. INICIALIZACIÃ“N
   ===============
   main.js
      â”‚
      â”œâ”€â–º Engine.init()
      â”‚      â””â”€â–º Crea scene, camera, renderer, bloom
      â”‚
      â”œâ”€â–º InputManager(renderer)
      â”‚      â””â”€â–º Configura eventos de teclado y mouse
      â”‚
      â”œâ”€â–º PlayerController(camera)
      â”‚      â””â”€â–º Inicializa fÃ­sica y movimiento
      â”‚
      â”œâ”€â–º UIManager.init()
      â”‚      â””â”€â–º Obtiene referencias a elementos DOM
      â”‚
      â””â”€â–º SceneManager(engine)
             â””â”€â–º Registra escenas disponibles

2. CARGA DE ESCENA
   ===============
   SceneManager.loadScene('main')
      â”‚
      â””â”€â–º MainScene.load()
             â”‚
             â”œâ”€â–º createStarfield()
             â”œâ”€â–º setupLights()
             â””â”€â–º SpaceStation.build()
                    â”‚
                    â”œâ”€â–º StationHub (Nucleus)
                    â”‚
                    â”œâ”€â–º Para cada mÃ³dulo:
                    â”‚   â”œâ”€â–º Portal.new()
                    â”‚   â”‚      â””â”€â–º loadGLTF()
                    â”‚   â”œâ”€â–º Catwalk.new()
                    â”‚   â”œâ”€â–º StationPad.new()
                    â”‚   â””â”€â–º createStrut()
                    â”‚
                    â””â”€â–º return { hubInfo, portals }

3. BUCLE DE RENDERIZADO
   ====================
   Engine.start()
      â”‚
      â””â”€â–º animate() [60 FPS]
             â”‚
             â”œâ”€â–º delta = clock.getDelta()
             â”œâ”€â–º elapsed = clock.elapsedTime
             â”‚
             â”œâ”€â–º App.update(delta, elapsed)
             â”‚      â”‚
             â”‚      â”œâ”€â–º PlayerController.update(delta)
             â”‚      â”‚      â”œâ”€â–º updateMovement()
             â”‚      â”‚      â”œâ”€â–º updatePhysics()
             â”‚      â”‚      â”œâ”€â–º updateCamera()
             â”‚      â”‚      â””â”€â–º checkPortalProximity()
             â”‚      â”‚
             â”‚      â”œâ”€â–º SceneManager.update(delta, elapsed)
             â”‚      â”‚      â””â”€â–º currentScene.update()
             â”‚      â”‚             â”œâ”€â–º Starfield rotation
             â”‚      â”‚             â””â”€â–º Portal animations
             â”‚      â”‚
             â”‚      â””â”€â–º UIManager.update()
             â”‚
             â”œâ”€â–º state.scene.mixers.forEach(m => m.update())
             â”‚
             â””â”€â–º composer.render()
```

## JerarquÃ­a de Componentes 3D (Atomic Design)

```
SCENE
  â”‚
  â”œâ”€â–º ORGANISMS (Complejos)
  â”‚     â”‚
  â”‚     â””â”€â–º SpaceStation
  â”‚           â”œâ”€â–º StationHub (Molecule)
  â”‚           â”œâ”€â–º Portal Ã— 3 (Molecule)
  â”‚           â”œâ”€â–º Catwalk Ã— N (Molecule)
  â”‚           â”œâ”€â–º StationPad Ã— N (Molecule)
  â”‚           â””â”€â–º Strut Ã— 3 (Atom)
  â”‚
  â”œâ”€â–º MOLECULES (Simples)
  â”‚     â”‚
  â”‚     â”œâ”€â–º Portal
  â”‚     â”‚     â”œâ”€â–º TorusGeometry (ring)
  â”‚     â”‚     â”œâ”€â–º CircleGeometry (plane)
  â”‚     â”‚     â”œâ”€â–º PointLight (beacon)
  â”‚     â”‚     â””â”€â–º GLTF Model (custom)
  â”‚     â”‚
  â”‚     â”œâ”€â–º Catwalk
  â”‚     â”‚     â”œâ”€â–º BoxGeometry (beam)
  â”‚     â”‚     â”œâ”€â–º BoxGeometry Ã— 2 (rails)
  â”‚     â”‚     â””â”€â–º BoxGeometry (collider)
  â”‚     â”‚
  â”‚     â”œâ”€â–º StationHub
  â”‚     â”‚     â”œâ”€â–º CylinderGeometry (plinth)
  â”‚     â”‚     â”œâ”€â–º CylinderGeometry (deck)
  â”‚     â”‚     â”œâ”€â–º CylinderGeometry (mast)
  â”‚     â”‚     â””â”€â–º TextSprite
  â”‚     â”‚
  â”‚     â””â”€â–º StationPad
  â”‚           â”œâ”€â–º BoxGeometry (pad)
  â”‚           â””â”€â–º BoxGeometry (collider)
  â”‚
  â””â”€â–º ATOMS (Primitivos)
        â”‚
        â”œâ”€â–º Starfield
        â”‚     â”œâ”€â–º Points (far layer)
        â”‚     â””â”€â–º Points (mid layer)
        â”‚
        â”œâ”€â–º TextSprite
        â”‚     â””â”€â–º Sprite (canvas texture)
        â”‚
        â”œâ”€â–º Strut
        â”‚     â””â”€â–º CylinderGeometry
        â”‚
        â””â”€â–º Platform
              â””â”€â–º BoxGeometry
```

## Sistema de Estado (Data Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INPUT (Eventos del Usuario)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                     â”‚
            â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   InputManager        â”‚           â”‚   Mouse/Keyboard Events    â”‚
â”‚                       â”‚           â”‚                            â”‚
â”‚  - onKeyDown()        â”‚           â”‚  - click                   â”‚
â”‚  - onKeyUp()          â”‚           â”‚  - mousemove               â”‚
â”‚  - onMouseMove()      â”‚           â”‚  - mousedown/up            â”‚
â”‚  - onPointerLock()    â”‚           â”‚  - pointerlockchange       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚     state.input (Mutate)     â”‚
            â”‚                              â”‚
            â”‚  - keys.w/a/s/d = true/falseâ”‚
            â”‚  - mouse.x/y                 â”‚
            â”‚  - jumpQueued                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   PlayerController.update()  â”‚
            â”‚                              â”‚
            â”‚  1. Read state.input         â”‚
            â”‚  2. Calculate movement       â”‚
            â”‚  3. Apply physics            â”‚
            â”‚  4. Update state.player      â”‚
            â”‚  5. Update camera position   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Engine.render()            â”‚
            â”‚                              â”‚
            â”‚  - Read camera.position      â”‚
            â”‚  - Render scene              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Sistema de Escenas (Scene Management)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SceneManager                              â”‚
â”‚                                                                   â”‚
â”‚  scenes: Map {                                                    â”‚
â”‚    'main' => MainScene                                            â”‚
â”‚    'interior' => InteriorScene (futuro)                           â”‚
â”‚    'game' => GameScene (futuro)                                   â”‚
â”‚  }                                                                â”‚
â”‚                                                                   â”‚
â”‚  currentScene: MainScene instance                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€â–º loadScene(name)
            â”‚      â”œâ”€â–º currentScene?.unload()
            â”‚      â”œâ”€â–º new SceneClass(engine)
            â”‚      â”œâ”€â–º scene.load()
            â”‚      â””â”€â–º return sceneData
            â”‚
            â”œâ”€â–º transitionTo(name)
            â”‚      â”œâ”€â–º Show flash effect
            â”‚      â”œâ”€â–º await loadScene(name)
            â”‚      â””â”€â–º Hide flash effect
            â”‚
            â””â”€â–º update(delta, elapsed)
                   â””â”€â–º currentScene.update()
```

## ConfiguraciÃ³n Centralizada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 src/config/moduleConfig.js                        â”‚
â”‚                                                                   â”‚
â”‚  export const MODULE_DEFINITIONS = [                              â”‚
â”‚    {                                                              â”‚
â”‚      name: 'Inicio',                                              â”‚
â”‚      color: 0x66ffff,                                             â”‚
â”‚      model: { url: '...', scale: 3.0, ... }                      â”‚
â”‚    },                                                             â”‚
â”‚    ...                                                            â”‚
â”‚  ]                                                                â”‚
â”‚                                                                   â”‚
â”‚  export const STATION_CONFIG = {                                  â”‚
â”‚    portalRadius: 36,                                              â”‚
â”‚    enablePortalLinks: false,                                      â”‚
â”‚    ...                                                            â”‚
â”‚  }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ import { MODULE_DEFINITIONS, STATION_CONFIG }
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            src/components/organisms/SpaceStation.js               â”‚
â”‚                                                                   â”‚
â”‚  build() {                                                        â”‚
â”‚    for (const def of MODULE_DEFINITIONS) {                        â”‚
â”‚      const portal = new Portal(                                   â”‚
â”‚        def.name,                                                  â”‚
â”‚        position,                                                  â”‚
â”‚        facing,                                                    â”‚
â”‚        def.color,                                                 â”‚
â”‚        def.model                                                  â”‚
â”‚      );                                                           â”‚
â”‚    }                                                              â”‚
â”‚  }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## PatrÃ³n de ComunicaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Portal   â”‚â”€â”€â–º mutations.addPortal(portal)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                               â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  State.scene.   â”‚
                     â”‚    portals[]    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PlayerController â”‚â—„â”€â”€â”€â”‚ state.scene.     â”‚
â”‚  .update()       â”‚    â”‚   portals        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€â–º checkPortalProximity()
               â””â”€â–º Detecta portal cercano
                   â””â”€â–º enterPortal(portal)
```

---

**Este diagrama muestra la arquitectura completa del proyecto refactorizado.** 
Cada mÃ³dulo tiene una responsabilidad especÃ­fica y se comunica con otros 
a travÃ©s del estado global centralizado. ğŸ—ï¸âœ¨
